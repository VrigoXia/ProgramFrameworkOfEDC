C51 COMPILER V8.05a   SETUP                                                                07/18/2017 08:22:50 PAGE 1   


C51 COMPILER V8.05a, COMPILATION OF MODULE SETUP
OBJECT MODULE PLACED IN .\setup.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\SOFTWARE\TASK\setup.c LARGE BROWSE DEBUG OBJECTEXTEND PRINT(.\setup.l
                    -st) TABS(2) OBJECT(.\setup.obj)

line level    source

   1          /************************************************************
   2          * 组织名称：
   3          * 文件名称: K:\单片机相关\电子大赛程序框架\SOFTWARE\TASK\SETUP.C
   4          * 作者:     周晨阳 
   5          * 版本:    
   6          * 日期:     2017/07/18
   7          * 描述:   初始化器件和测试器件使用
   8          * 历史修改记录:
   9          * <作者> <时间> <版本 > <描述>
  10          * 
  11          ***********************************************************/
  12          
  13          #include "setup.h"
  14          #include "../HARDWARE/DEVICES/SENSOR/ANGLE/ANGLE.h"
  15          #include "../../HARDWARE/DEVICES/BUTTON/BUTTON.h" 
  16          #include "../../HARDWARE/DEVICES/MOTOR/DC_MOTOR/MOTOR.h"
  17          #include "../../HARDWARE/DEVICES/LED/LED.h"
  18          #include "../../HARDWARE/BSP/USART1.h"
  19          #include "../../HARDWARE/BSP/timer.h"
  20          #include "../../HARDWARE/BSP/GPIO.h"
  21          #include "../../HARDWARE/BSP/delay.h"
  22          #include "../../HARDWARE/BSP/STC15_PWM.h"
  23          #include "../../HARDWARE/DEVICES/MOTOR/STEP_MOTOR/STEP_MOTOR.h"
  24          #include "../../HARDWARE/DEVICES/MOTOR/SERVO/SERVO.h"
  25          #include "../../HARDWARE/DEVICES/DISPLAY/1602/LCD1602.H"
  26          #include "../../HARDWARE/COMMON_HARDWARE/fixedPulser.h"
  27          
  28          
  29          
  30          /*************  串口1初始化函数 *****************/
  31          /*************************************************
  32          * 函数名称: void    UART1_init(unsigned long BandRate)
  33          * 描述: 串口1初始化函数
  34          * 输入: unsigned long BandRate ：串口的波特率，请在数值后加字母"L"，防止出问题
  35          * 输出: 调用此函数会发送一段测试语句 “ STC15w4k58s4 UART1 is open ”
  36          * 返回值: 无
  37          * 其他说明: 无
  38          *************************************************/
  39          void    UART1_init(unsigned long BandRate)
  40          {
  41   1        COMx_InitDefine     COMx_InitStructure;
  42   1        COMx_InitStructure.UART_Mode = UART_8bit_BRTx;
  43   1        COMx_InitStructure.UART_BRT_Use = BRT_Timer2;
  44   1        COMx_InitStructure.UART_BaudRate = BandRate;
  45   1        COMx_InitStructure.UART_RxEnable = ENABLE;
  46   1        COMx_InitStructure.BaudRateDouble = DISABLE;
  47   1        COMx_InitStructure.UART_Interrupt = ENABLE;
  48   1        COMx_InitStructure.UART_Polity = PolityHigh;
  49   1        COMx_InitStructure.UART_P_SW = UART1_SW_P30_P31;
  50   1        COMx_InitStructure.UART_RXD_TXD_Short = DISABLE;
  51   1        USART_Configuration(USART1, &COMx_InitStructure);
  52   1        // PrintString1("STC15w4k58s4's UART1 is open \r\n");   //串口测试
  53   1      }
  54          void test(void)
C51 COMPILER V8.05a   SETUP                                                                07/18/2017 08:22:50 PAGE 2   

  55          {
  56   1          //stepMotor_Init (STEP_MOTOR_1,1.8f,4,6000);
  57   1        //setStepMotorWithRound(STEP_MOTOR_1,30,100);   
  58   1      //  Init_Str_Motor(SERVO_1,0.5f,2.5f,180,300);
  59   1      //  //Init_Str_Motor(SERVO_2,0.5f,2.5f,180,300);
  60   1      //    //open_STR(SERVO_1);
  61   1      //   // set_STR_angle(SERVO_1,1);
  62   1      //      
  63   1      
  64   1      //   for(;i<180;i++)
  65   1      //  {
  66   1      //  set_STR_angle(SERVO_1,i);
  67   1      //  open_StepMotor(STEP_MOTOR_1);
  68   1      //    delay_ms(200);
  69   1      //    delay_ms(200);
  70   1      //    delay_ms(200);
  71   1      //  }
  72   1        //open_STR(SERVO_2);
  73   1          int i = 0;
  74   1        GPIO_InitTypeDef    GPIO_InitStructure;     //结构定义
  75   1        PWM_InitTypeDef  PWM_InitStructure;
  76   1      
  77   1      
  78   1        GPIO_InitStructure.Mode = GPIO_PullUp;       //指定IO的输入或输出方式,GPIO_PullUp,GPIO_HighZ,GPIO_OUT_OD,
             -GPIO_OUT_PP
  79   1      
  80   1        GPIO_InitStructure.Pin = GPIO_Pin_7;    //指定要初始化的IO, GPIO_Pin_0 ~ GPIO_Pin_7, 或操作
  81   1        GPIO_Inilize(GPIO_P3, &GPIO_InitStructure);  //初始化
  82   1        P37 = 1;
  83   1        PWM_UNLOCK;
  84   1        PWM_InitStructure.PWM_GOTO_ADC = DISABLE;
  85   1        PWM_InitStructure.PWM_V_INIT = PWM_LOW;
  86   1        PWM_InitStructure.PWM_0ISR_EN = DISABLE;
  87   1        PWM_InitStructure.PWM_OUT_EN = ENABLE;
  88   1        PWM_InitStructure.PWM_UNUSUAL_EN = DISABLE;
  89   1        PWM_InitStructure.PWM_UNUSUAL_OUT = DISABLE;
  90   1        PWM_InitStructure.PWM_UNUSUAL_ISR_EN = DISABLE;
  91   1        PWM_InitStructure.PWM_UNUSUAL_CMP0_EN = DISABLE;
  92   1        PWM_InitStructure.PWM_UNUSUAL_P24_EN = DISABLE;
  93   1        PWM_InitStructure.PWM_CLOCK = PWM_Clock_NT;
  94   1        PWM_InitStructure.PWM_CLOCK_DIV = 15;
  95   1        PWM_InitStructure.PWM_SELECTx_IO = PWM_SELECT_N;
  96   1        PWM_InitStructure.PWM_ISRx_EN = DISABLE;
  97   1        PWM_InitStructure.PWM_T1x_EN = DISABLE;
  98   1        PWM_InitStructure.PWM_T2x_EN = DISABLE;
  99   1        PWM_InitStructure.PWM_EN = DISABLE;
 100   1        PWM_Inilize(PWM_2, &PWM_InitStructure);
 101   1        PWM_LOCK;
 102   1        setPWM_DIV(PWM_2, 16);//16分频
 103   1        set_PWM_period(PWM_2, 50);
 104   1        set_PWM_duty(PWM_2, 0.1f);
 105   1        open_PWM_N(PWM_2);
 106   1      
 107   1        for (i = 100; i < 1000; i++)
 108   1        {
 109   2          set_PWM_duty(PWM_2, i / 1000.0f);
 110   2          delay_ms(200);
 111   2          delay_ms(200);
 112   2          delay_ms(200);
 113   2      
 114   2        }
 115   1      
C51 COMPILER V8.05a   SETUP                                                                07/18/2017 08:22:50 PAGE 3   

 116   1      }
 117          void setup(void)
 118          {
 119   1        UART1_init(115200L);
 120   1        // timerInit();
 121   1        Board_LED_Init();
 122   1        Button_config();
 123   1        ADC_config(ADC_P10, ADC_540T);
 124   1        //LCD1602_Init();
 125   1        EA = 1;
 126   1        test();
 127   1      
 128   1      }
 129          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    275    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      33
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
